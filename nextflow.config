params {

    // input options
    metadata_tsv                = null

    // biobakery databases
    uniref                      = "uniref90_diamond"
    chocophlan                  = "full"
    metaphlan_index             = "latest"

    // google
    google_project              = "omicidx-338300"
    google_region               = "us-central1"
    work_bucket                 = "gs://nextflow-bucket-work-6252a65b/v3/"
    store_bucket                = "gs://nextflow-bucket-store-6252a65b/v3/"
    publish_bucket              = "gs://nextflow-bucket-publish-6252a65b/v3/"

    store_dir = store_bucket
    publish_dir = publish_bucket
}

workDir = params.work_bucket

manifest {
    author = 'Sean Davis <seandavi@gmail.com>'
    defaultBranch = 'main'
    description = 'Curated Metagenomic Data pipeline'
    homePage = 'https://github.com/seandavi/curatedmetagenomicsnextflow'
    mainScript = 'main.nf'
    name = 'cmgd_nextflow'
    version = '1.0.0'

    // nextflowVersion
    // doi
    // recurseSubmodules
}

report {
    enabled = true
}

timeline {
    enabled = true
}

trace {
    enabled = true
    raw = true // no "GB", etc. Just numbers
    file = 'pipeline_trace.txt'
    fields = 'task_id,hash,native_id,process,tag,name,status,exit,module,container,cpus,time,disk,memory,attempt,submit,start,complete,duration,realtime,queue,%cpu,%mem,rss,vmem,peak_rss,peak_vmem,rchar,wchar,syscr,syscw,read_bytes,write_bytes,vol_ctxt,inv_ctxt'
}

weblog {
    enabled = true
    url = 'https://cmgd-telemetry-whnnxetv4q-uc.a.run.app/webhook'
}

process {
    executor = 'google-batch'
    disk = '250.GB' 
    errorStrategy = { task.exitStatus==14 ? 'retry' : 'terminate' } 
    maxRetries = 1
    container = 'gcr.io/omicidx-338300/curatedmetagenomics'
}

google {
        project=params.google_project  //'isb-cgc-01-0006'
        region = params.google_region
	    batch.debug = true
        workDir = params.work_bucket
        // preemptible
        batch.bootDiskSize = '20.GB'
        batch.spot = true
}


